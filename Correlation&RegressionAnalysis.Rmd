---
title: "REGRESSION AND CORRELATION ANALYSIS"
author: "ISE-540 (TEXT ANALYTICS) TEAM-1"
output:
    pdf_document:
        df_print: paged
        includes:
            in_header: header-includes.tex
    html_document:
        code_folding: false
        df_print: paged
toc: true
highlight: pygments
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE)
set.seed(7082)
options(digits = 6)
```
## Regression and Correlation Analysis on the Validation Set.

Validation set is part of the training data. The purpose of doing this is to see how the pattern of significance of the attributtes and the Review_Rating. By doing this on the validation set we can compare how the significance is varying when modelled using the Ground-truth vs modelled using the predictions. The predictions are generated by the BERT model which we have choosen as the best model for our project.

```{r}
#Loading the validation predictions file
setwd("~/Downloads")
#
dfbp=read.csv("bert_test_predictions_on_labelled_data.csv")
head(dfbp)
summary(dfbp)
str(dfbp)
#
```
From the above Regression results, it is clear that other than Wait Time, all other attributes are highly signifiant in predicting the Review Rating. Also the p-values are so small that we can reject the NULL Hyothesis with a confidence of 99%.

From the Correlation results, we can see the similar trend again. Except Wait Time, all other attributes have atleast some weak correation with Review_Rating. The correlation between Food Quality and Review_Rating is the strongest. Also there is a good correlation between Service and Review_Rating.


```{r}
# Regression and Correlation Analysis on the Ground-Truth
#
#ACTUAL VALUES
#
columns_actual <- c("Review_Rating", "Service", "Food.Quality", "Ambiance.Atmosphere", "Wait.Time", "Price", "Menu.Variety")
data_true<- dfbp[, columns_actual]
head(data_true)
str(data_true)
#
#Correlation
#
cor(data_true)
#
#Regression
#
model_true= lm(Review_Rating~.,data = data_true)
summary(model_true)
#
```



```{r}
# Regression and Correlation Analysis on the Validation Predictions generated from the model
#
#PREDICTED VALUES
#
columns_pred = c("Review_Rating", "Service.predicted", "Food.Quality.predicted", "Atmosphere.Ambiance.predicted", "Wait.Time.predicted", "Price.predicted", "Menu.Variety.predicted")
data_pred<-dfbp[, columns_pred]
head(data_pred)
str(data_pred)
#
#Correlation
#
cor(data_pred)
#
#Regression
#
model_pred = lm(Review_Rating~.,data = data_pred)
summary(model_pred)
#

```

The above results are generated from the predictions on the validation set. The regression shows that there is a high significance between Food Quality and Review_Rating and a good significance of Service and Ambiance/Atmosphere attributes. This model shows that the other variables are not much significant. 

Coming to the correlation, the values are even more higher than those obtained from the Ground Truth. But the trends are similar to those observed using the ground truths. Food Quality is highly correlated to the Review_Rating, then  is the service.

```{r}
library(ggplot2)
library(broom)
# Get coefficients and standard errors
coef_data <- tidy(model_pred)

# Plot the coefficient plot with adjusted column names
ggplot(coef_data, aes(x = term, y = estimate)) +
  geom_point(position = position_dodge(width = 0.2), size = 2) +
  geom_errorbar(
    aes(ymin = estimate - 1.96 * std.error, ymax = estimate + 1.96 * std.error),
    position = position_dodge(width = 0.2), width = 0.2, size = 1
  ) +
  labs(title = "Coefficient Plot for Predicting Review Rating", x = "Variable", y = "Coefficient") +
  theme_minimal()
```

## Correlation and Regression on the Unlabelled Data (1Million Test Data)

Here we do a similar analysis on the Test Data.

```{r}
#
#CORRELATION AND REFRESSION ANALYSIS ON UNLABELLED DATA
#
results = df0=read.csv("unlabeled_dataset_with_predictions.csv")
#
head(results)
# Selecting specific columns using a vector of column names
columns_to_select <- c("stars_x", "Service", "Food.Quality", "Atmosphere.Ambiance", "Wait.time", "Price", "Menu.Variety")
results_final <- results[, columns_to_select]

# Display the resulting DataFrame
print(head(results_final))
print(str(results_final))
names(results_final)[names(results_final) == "stars_x"] <- "Overall_Rating"
head(results_final)
#
#Correlation Analysis
#Pearsons Correlation
#
cor(results_final)
#
#
#Linear Regression Model
#
model2 = lm(Overall_Rating~Service+Food.Quality+Atmosphere.Ambiance+Wait.time+Price+Menu.Variety,data=results_final)
summary(model2)
#
```

Though, the results on the entire test data are not so clear. But we can still see that Food Quality is significant in predicting the Overall_Rating of the Restaurant. Though there is a lot of future scope on this analysis, we can say that some of these attributes/factors are contributing to the Rating a restaurant recieves and hence are important to focus when planning a business.

